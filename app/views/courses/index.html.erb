<div class="container-fluid courses-page">
  <div class="row">
    <div class="col-sm-10 col-sm-offset-1">
      <blockquote><%= @quote[:text] %> <span class="author">&nbsp; <%= @quote[:author] %></span></blockquote>
    </div>
  </div>
  <% if current_user.is_admin? %>
    <div class="row">
      <div class="col-sm-12 text-center">
        <%= link_to "<span class='glyphicon glyphicon-plus'></span> &nbsp;Nuevo Curso".html_safe, new_course_path, class: "btn btn-success new-course-btn" %>
      </div>
    </div>
  <% end %>
    <% @courses_by_phase.each do |phase, courses| %>
      <div class="row phase phase-<%=phase%>">
        <div class="col-xs-6 col-md-1 phase-title">
          <h2>Fase <%= phase %></h2>
        </div>
        <div class="clearfix"></div>
        <% courses.each_with_index do |course, i| %>
            <div class="col-sm-4">
              <div class="course" id="course<%= course.id %>" data-sortable="true" data-resource-id="<%= course.id %>">
                <% if current_user.is_admin? %>
                <div class="actions">
                  <% if !course.published %><span class="glyphicon glyphicon-exclamation-sign action action-warn" data-toggle="tooltip" data-placement="bottom" title="No publicado"></span><% end %>
                  <%= link_to "<span class='glyphicon glyphicon-pencil action action-edit'></span>".html_safe, edit_course_path(course) %>
                  <a href="#"><span class='glyphicon glyphicon-remove action action-remove'></span></a>
                </div>
                <% end %>
                <div class="title"><%= course.name %></div>
                <%= progress_bar(progress: current_user.progress(course)) %>
                <p><%= course.description %></p>
                <div class="row info">
                  <div class="col-xs-4 info-item">
                    <span class="info-item-value"><%= course.challenges.published.count %></span>
                    <span class="info-item-label"><%= "Reto".pluralize(course.challenges.published.count) %></span>
                  </div>
                  <div class="col-xs-4 info-item">
                    <span class="info-item-value"><%= course.resources.published.count %></span>
                    <span class="info-item-label"><%= "Recurso".pluralize(course.resources.published.count) %></span>
                  </div>
                  <div class="col-xs-4 info-item">
                    <span class="info-item-value"><%= course.projects.published.count %></span>
                    <span class="info-item-label"><%= "Proyecto".pluralize(course.projects.published.count) %></span>
                  </div>
                </div>
                <div class="text-center"><%= link_to "Entrar", course, class: "btn btn-primary btn-block" %></div>
              </div>
            </div>
            <% if i % 3 == 2 %>
              <!-- <div class="clearfix"></div> -->
            <% end %>
        <% end %>
      </div>
    <% end %>
</div>

<%= render 'profile_questions' unless current_user.active? %>

<% if current_user.is_admin? %>
  <script>
    (function() {

      sortable_courses =  new SortableView({el: ".courses-page",resource:"courses"})

      $(document).on("page:before-change", function() {
        sortable_courses.remove();
      });
    })()
  </script>
<% end %>
